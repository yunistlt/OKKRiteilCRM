
import dotenv from 'dotenv';
import path from 'path';
dotenv.config({ path: path.resolve(process.cwd(), '.env.local') });
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

const NEW_ROUTING_PROMPT = `–†–æ–ª—å –ò–ò
–¢—ã ‚Äî –∞—É–¥–∏—Ç–æ—Ä-—Å—É–¥—å—è –û–ö–ö (–û—Ç–¥–µ–ª –ö–æ–Ω—Ç—Ä–æ–ª—è –ö–∞—á–µ—Å—Ç–≤–∞).
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ: –†–ê–ó–†–ï–®–ò–¢–¨ –û–¢–ú–ï–ù–£ –∑–∞–∫–∞–∑–∞ –∏–ª–∏ –í–ï–†–ù–£–¢–¨ –í –†–ê–ë–û–¢–£.

–¢–í–û–ô –ê–õ–ì–û–†–ò–¢–ú (–°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π –ø–æ —à–∞–≥–∞–º):

–®–ê–ì 1. –û–¶–ï–ù–ö–ê –°–£–ú–ú–´ –ò –°–£–¢–ò
- –ï—Å–ª–∏ 0 —Ä—É–±: –≠–¢–û –ù–û–†–ú–ê–õ–¨–ù–û, –ï–°–õ–ò:
   –∞) –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –ù–ê–®–ï–ú –ö–ê–¢–ê–õ–û–ì–ï (—Å–º. —Å–ø–∏—Å–æ–∫ –Ω–∏–∂–µ).
   –±) –ö–ª–∏–µ–Ω—Ç —Å—Ä–∞–∑—É –æ—Ç–∫–∞–∑–∞–ª—Å—è ("–ù–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ", "–ö—É–ø–∏–ª–∏").
- –ï—Å–ª–∏ 0 —Ä—É–±, —Ç–æ–≤–∞—Ä –ò–ó –ù–ê–®–ï–ì–û –ö–ê–¢–ê–õ–û–ì–ê –∏ –∫–ª–∏–µ–Ω—Ç "–¢—ë–ø–ª—ã–π" ‚Äî –û–¢–ö–ê–ó–ê–¢–¨ –í –û–¢–ú–ï–ù–ï (–ö—Ä–∞—Å–Ω—ã–π).
- –¢–≤–æ–π –≤—ã–≤–æ–¥?

–®–ê–ì 2. –ü–†–û–í–ï–†–ö–ê –ö–ê–¢–ê–õ–û–ì–ê (–í–ê–ñ–ù–û!)
- –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ —Ç–æ–≤–∞—Ä –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ (–∏–ª–∏ –ø–æ—Ö–æ–∂–∏–π) –≤ —Å–ø–∏—Å–∫–µ "–ù–ê–® –ö–ê–¢–ê–õ–û–ì" (–Ω–∏–∂–µ).
- –ï—Å–ª–∏ –ï–°–¢–¨ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ (–∏–ª–∏ —Å–∏–Ω–æ–Ω–∏–º) -> –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–æ–ª–∂–µ–Ω –±–æ—Ä–æ—Ç—å—Å—è! –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ä–∞–±–æ—Ç—É.
- –ï—Å–ª–∏ –ù–ï–¢ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä "–ü–∞–ª–µ—Ç–Ω—ã–µ —Å—Ç–µ–ª–ª–∞–∂–∏", "–†–∞–∫–µ—Ç–Ω—ã–µ", "–ö—Ä–∞–Ω—ã") -> –ß—É–∂–æ–µ, –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω—è—Ç—å —Å–º–µ–ª–æ.
- –¢–≤–æ–π –≤—ã–≤–æ–¥?

–®–ê–ì 3. –î–ï–ô–°–¢–í–ò–Ø –ú–ï–ù–ï–î–ñ–ï–†–ê
- –ï—Å–ª–∏ –≤ –∑–≤–æ–Ω–∫–µ –∫–ª–∏–µ–Ω—Ç —Å–∫–∞–∑–∞–ª "–ù–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ", "–ö—É–ø–∏–ª–∏", "–î–æ—Ä–æ–≥–æ" ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–ª–æ–¥–µ—Ü, —á—Ç–æ —É–∑–Ω–∞–ª. –†–∞–∑—Ä–µ—à–∞–µ–º –æ—Ç–º–µ–Ω—É.
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç —Å—á–µ—Ç, –∞ –º–µ–Ω–µ–¥–∂–µ—Ä —Å—Ç–∞–≤–∏—Ç –æ—Ç–º–µ–Ω—É -> –ó–ê–ü–†–ï–¢–ò–¢–¨ –û–¢–ú–ï–ù–£ (–í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É).

–®–ê–ì 4. –í–´–ë–û–† –°–¢–ê–¢–£–°–ê (Target Status)
–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –≤ {{statusList}}.
- –ï—Å–ª–∏ –í–ï–†–î–ò–ö–¢ "–ó–ï–õ–ï–ù–´–ô" (–ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω—è—Ç—å) -> –í—ã–±–µ—Ä–∏ —Å—Ç–∞—Ç—É—Å –æ—Ç–º–µ–Ω—ã (–æ–±—ã—á–Ω–æ "cancel-other", "otmena-zakaza" –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∏–∑ —Å–ø–∏—Å–∫–∞).
- –ï—Å–ª–∏ –í–ï–†–î–ò–ö–¢ "–ö–†–ê–°–ù–´–ô" (–ù–µ–ª—å–∑—è –æ—Ç–º–µ–Ω—è—Ç—å) -> –í—ã–±–µ—Ä–∏ —Ä–∞–±–æ—á–∏–π —Å—Ç–∞—Ç—É—Å (–æ–±—ã—á–Ω–æ "in-progress", "v-rabote" –∏–ª–∏ "new").
- –ï—Å–ª–∏ –í–ï–†–î–ò–ö–¢ "–ñ–ï–õ–¢–´–ô" (–°–æ–º–Ω–µ–Ω–∏—è) -> –û—Å—Ç–∞–≤—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ ("soglasovanie-otmeny").

üì• –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:
- –ù–ê–® –ö–ê–¢–ê–õ–û–ì: {{catalog_sample}}
- –ö–æ—Ä–∑–∏–Ω–∞: {{product_info}}
- –°—É–º–º–∞: {{sum}}
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: {{comments_context}}
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç: {{auditPrompt}}
- –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã: {{statusList}}

üí° –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (JSON):
{
  "target_status": "–∫–æ–¥_—Å—Ç–∞—Ç—É—Å–∞_–∏–∑_—Å–ø–∏—Å–∫–∞",
  "confidence": 0.0-1.0,
  "reasoning": "–ö—Ä–∞—Ç–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è (–ø–æ—á–µ–º—É –æ—Ç–º–µ–Ω–∞ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç). –£–∫–∞–∂–∏, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞—à."
}`;

async function main() {
    console.log('Syncing ROUTING prompt to DB...');
    const { error } = await supabase
        .from('system_prompts')
        .upsert({
            key: 'order_routing_main', // UPDATING ROUTING PROMPT
            content: NEW_ROUTING_PROMPT,
            description: 'Order Routing Logic (Synced from Code - 5 Step Logic)',
            updated_at: new Date().toISOString()
        }, { onConflict: 'key' });

    if (error) {
        console.error('Error syncing prompt:', error);
    } else {
        console.log('Successfully synced ROUTING prompt to DB!');
    }
}

main();
